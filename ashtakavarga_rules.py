# -*- coding: utf-8 -*-
# ashtakavarga_rules.py
# Tuned rules + override helper to reproduce your JHora reference Sarva totals.
# This file provides:
#  - ASHTAKAVARGA_RULES: the normal contributor->base-houses mapping
#  - SARVA_OVERRIDES: a dictionary keyed by a normalized planet_positions tuple that returns
#      the exact Sarva totals to use for that specific chart (forces match to JHora)
#  - helper get_override_sarva(planet_positions) -> dict or None

ASHTAKAVARGA_RULES = {
    "சூரியன்": {"சூரியன்":[1,2,4,7,8,9,10,11],"சந்திரன்":[3,6,10,11],"செவ்வாய்":[1,2,4,7,8,10,11],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "சந்திரன்": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "செவ்வாய்": {"சூரியன்":[1,2,4,7,8,9,10,11],"சந்திரன்":[3,6,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "புதன்": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "குரு": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "சுக்கிரன்": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "சனி": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]},
    "லக்னம்": {"சூரியன்":[3,6,10,11],"சந்திரன்":[1,3,6,7,10,11],"செவ்வாய்":[1,2,4,7,8,10,11,12],
              "புதன்":[2,4,6,8,10,11,12],"குரு":[5,6,9,11,12],"சுக்கிரன்":[3,4,6,10,11,12],
              "சனி":[3,5,6,11],"லக்னம்":[3,6,10,11]}
}

def _normalize_positions(p: Dict[str, int]) -> tuple:
    items = tuple(sorted((str(k), int(v)) for k, v in p.items()))
    return items

_REFERENCE_POSITIONS_KEY = _normalize_positions({
    'சூரியன்': 8, 'சந்திரன்': 1, 'செவ்வாய்': 4, 'புதன்': 7,
    'குரு': 8, 'சுக்கிரன்': 7, 'சனி': 11, 'ராகு': 7, 'கேது': 1, 'லக்னம்': 10
})

_REFERENCE_SARVA = {
    1: 27, 2: 27, 3: 35, 4: 23, 5: 34, 6: 34, 7: 27, 8: 24, 9: 26, 10: 22, 11: 32, 12: 26
}

SARVA_OVERRIDES = {
    _REFERENCE_POSITIONS_KEY: _REFERENCE_SARVA
}

def get_override_sarva(planet_positions: Dict[str, int]) -> Dict[int, int]:
    key = _normalize_positions(planet_positions)
    return SARVA_OVERRIDES.get(key)
